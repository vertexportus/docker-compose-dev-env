#!/usr/bin/env bash

exec_command() {
    cmd=$1
    case "$cmd" in
        "link")
            if [[ -z "$2" ]]; then exit 1; fi
            composer config repositories.local '{"type": "path", "url": "'$2'"}' --file composer.json
            ;;
        "init")
            if [[ -z "$1" ]]; then exit 1; fi
            local folder=$1
            cd $ENV_PATH/src
            mkdir $folder
            docker run --rm --user $UID:$UID --interactive --tty --volume $ENV_PATH/src/$folder:/app composer /bin/bash -c "composer init"
            printf "$2/\n" >> "$ENV_PATH/src/.gitignore"
            ;;
        *)
            if [[ -z "$1" ]]; then exit 1; fi
            local folder=$1
            shift
            docker run --rm --user $UID:$UID --interactive --tty --volume $ENV_PATH/src/$folder:/app composer /bin/bash -c "composer $*"
            ;;
    esac
}

if [[ -n $ENV_HELP ]]; then
    printf "\e[36mruns 'composer' inside the 'php' container: \n  > \e[36;1m$ENV_COMMAND composer <commands>\e[0m\n"
    printf "         -\e[36m creates a composer local link for package development: \n  > \e[36;1m$ENV_COMMAND composer link <path>\e[0m\n"
else
    cd $ENV_PATH
    exec_command $*
    printf "\n"
fi
